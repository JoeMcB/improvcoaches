<% set_meta_tags title: @space.name, reverse: true %>
<% set_meta_tags canonical: space_url(@space) %>

<!-- Main Space Container -->
<div class="min-h-screen py-4">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Header Section -->
    <div class="mb-6">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <h1 class="text-4xl font-bold text-heading mb-4 sm:mb-0">
          <%= @space.name %>
        </h1>
      </div>
    </div>
    
    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      
      <!-- Left Sidebar - Contact & Actions -->
      <div class="lg:col-span-4 xl:col-span-3">
        <div class="space-y-6">
          
          <!-- Contact Card -->
          <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-purple-50">
              <h2 class="text-xl font-semibold text-purple-900 flex items-center">
                <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                </svg>
                Contact Info
              </h2>
            </div>
            
            <div class="p-6">
              <!-- Address -->
              <div class="mb-6">
                <div class="text-gray-900 font-medium mb-2">
                  <%= @space.address %>
                  <% if !@space.address_2.nil? %>
                    <br><%= @space.address_2 %>
                  <% end %>
                </div>
                <div class="text-gray-600"><%= @space.real_city %>, <%= @space.state %> <%= @space.zip %></div>
              </div>
              
              <!-- Contact Actions -->
              <div class="space-y-3">
                <% unless @space.phone.nil? %>
                  <%= link_to "tel:#{@space.phone}", 
                      class: "w-full inline-flex items-center justify-center px-4 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors duration-200" do %>
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                    </svg>
                    <%= @space.phone %>
                  <% end %>
                <% end %>

                <% unless @space.website_link.nil? %>
                  <%= link_to @space.website_link, target: "_blank", 
                      class: "w-full inline-flex items-center justify-center px-4 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200" do %>
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4.083 9h1.946c.089-1.546.383-2.97.837-4.118A6.004 6.004 0 004.083 9zM10 2a8 8 0 100 16 8 8 0 000-16zm0 2c-.076 0-.232.032-.465.262-.238.234-.497.623-.737 1.182-.389.907-.673 2.142-.766 3.556h3.936c-.093-1.414-.377-2.649-.766-3.556-.24-.559-.499-.948-.737-1.182C10.232 4.032 10.076 4 10 4zm3.971 5c-.089-1.546-.383-2.97-.837-4.118A6.004 6.004 0 0115.917 9h-1.946zm-2.003 2H8.032c.093 1.414.377 2.649.766 3.556.24.559.499.948.737 1.182.233.23.389.262.465.262.076 0 .232-.032.465-.262.238-.234.497-.623.737-1.182.389-.907.673-2.142.766-3.556zm1.166 4.118c.454-1.148.748-2.572.837-4.118h1.946a6.004 6.004 0 01-2.783 4.118zm-6.268 0C6.412 13.97 6.118 12.546 6.03 11H4.083a6.004 6.004 0 002.783 4.118z" clip-rule="evenodd"></path>
                    </svg>
                    Visit Website
                  <% end %>
                <% end %>

                <% unless @space.email.nil? %>
                  <%= mail_to @space.email, 
                      class: "w-full inline-flex items-center justify-center px-4 py-3 bg-purple-600 text-white font-medium rounded-lg hover:bg-purple-700 transition-colors duration-200" do %>
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                      <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                    </svg>
                    Send Email
                  <% end %>
                <% end %>
              </div>
              
              <!-- External Links -->
              <div class="mt-6 pt-6 border-t border-gray-200">
                <h3 class="text-sm font-medium text-gray-900 mb-3">Find on</h3>
                <div class="flex gap-3">
                  <%= link_to "http://maps.google.com/?q=#{@space.compiled_address}", target: "_blank", 
                      class: "flex-1 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200 flex items-center justify-center" do %>
                    <%= image_tag '3rdparty/google_maps_logo_58.jpeg', class: "h-6" %>
                  <% end %>
                  
                  <% unless @space.yelp_link.nil? %>
                    <%= link_to @space.yelp_link, target: "_blank", 
                        class: "flex-1 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200 flex items-center justify-center" do %>
                      <%= image_tag '3rdparty/yelp_logo_50x25.jpeg', class: "h-6" %>
                    <% end %>
                  <% end %>
                  
                  <% unless @space.facebook_link.nil? %>
                    <%= link_to @space.facebook_link, target: "_blank", 
                        class: "flex-1 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200 flex items-center justify-center" do %>
                      <%= image_tag '3rdparty/FB-f-Logo__blue_50.png', class: "h-6" %>
                    <% end %>
                  <% end %>
                </div>
              </div>
              
              <!-- Admin Actions -->
              <% if current_user && current_user.is_admin? %>
                <div class="mt-6 pt-6 border-t border-gray-200">
                  <h3 class="text-sm font-medium text-gray-900 mb-3">Admin Actions</h3>
                  <div class="space-y-3">
                    <%= link_to edit_space_path(@space), 
                        class: "w-full inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200" do %>
                      <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                      </svg>
                      Edit Space
                    <% end %>

                    <%= link_to @space, method: :delete, data: { confirm: 'Are you sure?' }, 
                        class: "w-full inline-flex items-center justify-center px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition-colors duration-200" do %>
                      <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"></path>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414L7.586 12l-1.293 1.293a1 1 0 101.414 1.414L9 13.414l1.293 1.293a1 1 0 001.414-1.414L10.414 12l1.293-1.293z" clip-rule="evenodd"></path>
                      </svg>
                      Remove Space
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="lg:col-span-8 xl:col-span-9">
        <div class="space-y-8">
          
          <!-- Photos Section -->
          <% if @space.space_images.any? %>
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
              <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
                  </svg>
                  Photos
                </h2>
              </div>
              <div class="p-6">
                <div id="space-images-carousel" class="carousel slide" data-ride="carousel">
                  <div class="carousel-inner rounded-lg overflow-hidden">
                    <% @space.space_images.order(:sort_order).each_with_index do |space_image, index| %>
                      <div class="carousel-item <%= 'active' if index == 0 %>">
                        <%= image_tag space_image.large, class: "d-block w-100 h-96 object-cover" %>
                      </div>
                    <% end %>
                  </div>
                  <a class="carousel-control-prev" href="#space-images-carousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                  </a>
                  <a class="carousel-control-next" href="#space-images-carousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                  </a>
                </div>
              </div>
            </div>
          <% end %>

          <!-- About Section -->
          <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
              <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                About <%= @space.name %>
              </h2>
            </div>
            <div class="p-6">
              <div class="prose prose-blue max-w-none mb-6">
                <%= simple_format @space.description %>
              </div>
              
              <!-- Space Type Badges -->
              <div class="flex gap-3">
                <% if @space.is_rehearsal? %>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                    </svg>
                    Available for Rehearsals
                  </span>
                <% end %>

                <% if @space.is_performance? %>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                    </svg>
                    Available for Performances
                  </span>
                <% end %>
              </div>
            </div>
          </div>

          <!-- Feedback Section -->
          <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
              <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                </svg>
                Feedback
              </h2>
            </div>
            <div class="p-6">
              <div class="fb-comments" data-href="<%= space_url @space %>" data-num-posts="10" data-order-by="reverse_time" data-width="100%"></div>
            </div>
          </div>

          <!-- Map Section -->
          <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
              <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                </svg>
                Location
              </h2>
            </div>
            <div class="p-6">
               <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB45xIVXhmt-03fS12e2-eXn3ke3NitrO8&sensor=false"></script>
               <script type="text/javascript">
                function initialize() {
                  var gc = new google.maps.Geocoder();
                  gc.geocode( { address: "<%= @space.compiled_address %>"}, function(result, status){
                    var latLng = (result[0]).geometry.location;
                    var marker = new google.maps.Marker({
                      position: latLng
                    });
                    var mapOptions = {
                      center: latLng,
                      zoom: 16,
                      draggable: false,
                    };
                    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
                    marker.setMap(map);
                  });
                }
                google.maps.event.addDomListener(window, 'load', initialize);
              </script>
              <div id="map-canvas" class="w-full h-96 rounded-lg overflow-hidden"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>